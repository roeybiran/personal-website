---
import type { CollectionEntry } from "astro:content";
import AppPage from "../../../layouts/AppPage.astro";
import { getEntry } from "astro:content";
import R404 from "../../../util/Response404";

export const prerender = false;

const slug = Astro.params.app ?? "";
const entry: CollectionEntry<"apps"> | undefined = await getEntry("apps", slug);

if (!entry?.data.releaseNotesURL) return R404;

const data = await fetch(entry?.data.releaseNotesURL);
const text: string = await data.text();
const [, body] = text.match(/<body>(.+?)<\/body>/s) ?? [];
const pageTitleSuffix = "Release Notes";

if (!body) return R404;
---

<AppPage pageTitleSuffix={pageTitleSuffix} appSlug={slug} appEntry={entry}>
  <div class="release-notes" set:html={body} />
</AppPage>
